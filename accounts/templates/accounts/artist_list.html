{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artist Directory</title>
    <link rel="stylesheet" href="{% static 'css/artist_directory2.css' %}">
    <style>
        /* ðŸŒ™ Dark Mode Styles */
body.dark-mode {
    background-color: #121212;
    color: #ffffff;
}

/* âœ… Update other elements for dark mode */
.dark-mode .header,
.dark-mode .navbar {
    background-color: #222;
}

.dark-mode .nav-link {
    color: white;
}

.dark-mode .search-form {
    background: #333;
    box-shadow: 0px 4px 6px rgba(255, 255, 255, 0.1);
}

.dark-mode input,
.dark-mode textarea,
.dark-mode select {
    background-color: #222;
    color: white;
    border: 1px solid #555;
}

.dark-mode .book-btn {
    background-color: #D8648C;
    color: white;
}

.dark-mode .book-btn:hover {
    background-color: #b24d70;
}

.dark-mode .artist-container {
    background-color: #1a1a1a;
}

/* âœ… Toggle Switch */
#dark-mode-toggle {
    position: fixed;
    top: 10px;
    right: 20px;
    background: #222;
    color: white;
    border: none;
    padding: 10px 15px;
    cursor: pointer;
    border-radius: 5px;
}

.dark-mode #dark-mode-toggle {
    background: #f8f9fa;
    color: #222;
}

    </style>
</head>
<body>
    <div class="back-to-home">
        <button onclick="window.location.href='{% url 'home' %}'">Back to Home</button>
    </div>
    <!-- <button id="dark-mode-toggle">ðŸŒ™ Dark Mode</button> -->

  <!-- âœ… Filter Section -->
<div class="filter-container">
    <label for="city-filter">Filter by City:</label>
    <select id="city-filter" onchange="filterArtists()">
        <option value="all">All Cities</option>
        {% for city in cities %}
            <option value="{{ city }}">{{ city }}</option>
        {% endfor %}
    </select>

    <label for="price-filter">Filter by Price:</label>
    <select id="price-filter" onchange="filterArtists()">
        <option value="all">All Prices</option>
        <option value="0-500">Rs. 0 - Rs. 500</option>
        <option value="501-1000">Rs. 501 - Rs. 1000</option>
        <option value="1001-2000">Rs. 1001 - Rs. 2000</option>
        <option value="2001-5000">Rs. 2001 - Rs. 5000</option>
        <option value="5001-10000">Rs. 5001 - Rs. 10000</option>
        <option value="10000+">Rs. 10000+</option>
    </select>
</div>

<!-- âœ… Artists List -->
<div class="artist-container">
    {% for artist in artists %}
    <div class="artist-card" data-city="{{ artist.city }}">
        <div class="artist-image">
            {% if artist.profile_image %}
                <img src="{{ artist.profile_image.url }}" alt="{{ artist.first_name }} {{ artist.last_name }}">
            {% else %}
                <img src="{% static 'images/default_profile.png' %}" alt="Default Profile Image">
            {% endif %}
        </div>
        <div class="artist-info">
            <h3>{{ artist.first_name }} {{ artist.last_name }}</h3>
            <p>Email: {{ artist.email }}</p>
            <p class="artist-city">City: {{ artist.city }}</p>

            <!-- âœ… Display Services and Prices -->
            {% if artist.services.exists %}
                <h4>Services Offered:</h4>
                <ul>
                    {% for service in artist.services.all %}
                        <li class="service-item" data-price="{{ service.price }}">
                            {{ service.service_name }} - Rs. {{ service.price }}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No services listed.</p>
            {% endif %}

            <div class="button-group">
                <button onclick="bookArtist('{{ artist.id }}')">Book Now</button>
                <button onclick="chatWithArtist('{{ artist.id }}')">Chat Now</button>
                <button onclick="window.location.href='{% url 'artist_detail' artist.id %}'">Explore Artist</button>
            </div>
        </div>
    </div>
    {% empty %}
    <p>No artists registered yet.</p>
    {% endfor %}
</div>

    <script>
       function filterArtists() {
    let selectedCity = document.getElementById("city-filter").value.toLowerCase();
    let selectedPrice = document.getElementById("price-filter").value;
    let artists = document.querySelectorAll(".artist-card");

    artists.forEach(artist => {
        let artistCity = artist.getAttribute("data-city").toLowerCase();
        let serviceItems = artist.querySelectorAll(".service-item");
        let showArtist = false;

        serviceItems.forEach(service => {
            let servicePrice = parseInt(service.getAttribute("data-price"));

            if (priceMatches(servicePrice, selectedPrice)) {
                showArtist = true;
            }
        });

        if ((selectedCity === "all" || artistCity === selectedCity) && showArtist) {
            artist.style.display = "block";
        } else {
            artist.style.display = "none";
        }
    });
}

function priceMatches(servicePrice, selectedPrice) {
    if (selectedPrice === "all") return true;

    let [minPrice, maxPrice] = selectedPrice.split("-").map(Number);

    if (selectedPrice === "10000+" && servicePrice >= 10000) return true;
    if (servicePrice >= minPrice && (maxPrice ? servicePrice <= maxPrice : true)) return true;

    return false;
}

document.addEventListener("DOMContentLoaded", function () {
    const darkModeToggle = document.getElementById("dark-mode-toggle");
    const body = document.body;

    // âœ… Check if dark mode is enabled in localStorage
    if (localStorage.getItem("darkMode") === "enabled") {
        body.classList.add("dark-mode");
        darkModeToggle.textContent = "â˜€ Light Mode";
    }

    // âœ… Toggle Dark Mode
    darkModeToggle.addEventListener("click", function () {
        body.classList.toggle("dark-mode");

        // âœ… Save the preference in localStorage
        if (body.classList.contains("dark-mode")) {
            localStorage.setItem("darkMode", "enabled");
            darkModeToggle.textContent = "â˜€ Light Mode";
        } else {
            localStorage.setItem("darkMode", "disabled");
            darkModeToggle.textContent = "ðŸŒ™ Dark Mode";
        }
    });
});

    </script>
</body>
</html>
