{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking History</title>
    <link rel="stylesheet" href="{% static 'css/booking_history.css' %}">
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="{% static 'images/logo.png' %}" alt="Artist Finder Logo">
        </div>
        <nav class="navbar">
            <a href="{% url 'home' %}" class="nav-link">Home</a>
            <a href="{% url 'booking_history' %}" class="nav-link">Booking History</a>

            <a href="{% url 'aboutus' %}" class="nav-link">About Us</a>

            <a href="{% url 'contactus' %}" class="nav-link active">Contact Us</a>

            {% for artist in artists %}
    <a href="{% url 'user_chat' artist.id %}" class="nav-item">Chat with {{ artist.first_name }}</a>
{% endfor %}



            <a href="{% url 'artist_list' %}">View All Artists</a>

            <!-- ✅ Correct logout URL -->
            <a href="{% url 'login' %}" class="nav-link">Logout</a>

            <div class="user-profile">
                <a href="{% url 'user_profile' %}">
                    <img src="{% static 'images/mi.jpg' %}" alt="User" class="user-image">
                </a>
            </div>
        </nav>
    </header>


    <div class="booking-history-container">
        <h2>My Booking History</h2>

        <!-- ✅ Booking List -->
        {% if user_bookings %}
            <table>
                <thead>
                    <tr>
                        <th>Artist</th>
                        <th>Service</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Duration</th>
                        <th>Payment</th>
                        <th> Price </th>
                        <th>Status</th>
                        
                        
                    </tr>
                </thead>
                <tbody>
                    {% for booking in user_bookings %}
                    <tr>
                        <td>{{ booking.artist.first_name }} {{ booking.artist.last_name }}</td>
                        <td>{{ booking.service.service_name }}</td>
                        <td>{{ booking.date }}</td>
                        <td>{{ booking.time }}</td>
                        <td>{{ booking.service.duration }}</td>
                        <td>{{ booking.payment_method|title }}</td>
                        <td>{{ booking.service.price}}</td>
                        <td id="status-{{ booking.id }}">{{ booking.status }}</td>
                        
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No bookings found.</p>  <!-- ✅ Show message if no bookings -->
        {% endif %}

        
        
    </div>

    <script>
        // ✅ Function to Update Status and Notifications Dynamically
        function updateUserNotification(bookingId, status, message) {
            // ✅ Update Status in Booking Table
            let statusElement = document.getElementById(`status-${bookingId}`);
            if (statusElement) {
                statusElement.innerText = status;
            }

            // ✅ Show SweetAlert2 Notification
            Swal.fire({
                title: "Booking Update",
                text: message,
                icon: "info",
                confirmButtonText: "OK"
            });

            // ✅ Add Notification to List
            let notificationContainer = document.querySelector(".notifications-container ul");
            if (!notificationContainer) {
                document.querySelector(".notifications-container").innerHTML = "<ul></ul>";
                notificationContainer = document.querySelector(".notifications-container ul");
            }

            let newNotification = document.createElement("li");
            newNotification.innerHTML = `${message} (${new Date().toLocaleString()})`;
            notificationContainer.prepend(newNotification);
        }
    </script>
</body>
</html>
